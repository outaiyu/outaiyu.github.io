<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hillsboro Allergenic Plants - STEM Project</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root {
            --primary: #00cc66;
            --accent: #0099cc;
            --danger: #ef4444;
            --warning: #f97316;
            --success: #22c55e;
            --dark: #0a0e14;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
            --surface: #151b23;
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--dark); }
        ::-webkit-scrollbar-thumb { background: var(--text-muted); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text); }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
            background: var(--dark);
            color: var(--text);
            -webkit-font-smoothing: antialiased;
        }
        #map {
            position: fixed;
            inset: 0;
            z-index: 0;
            border: none;
            box-shadow: none;
        }
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: var(--dark);
            border-bottom: 1px solid var(--border);
            padding: 1rem 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        .subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
            font-weight: 400;
        }
        .logo {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
            filter: drop-shadow(0 0 8px rgba(0, 204, 102, 0.5)) drop-shadow(0 0 16px rgba(0, 204, 102, 0.3));
        }
        @media (min-width: 769px) and (hover: hover) {
            .header {
                padding: 1.25rem 2rem;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 1px rgba(255, 255, 255, 0.1) inset;
            }
            .logo {
                font-size: 2rem;
                background: linear-gradient(135deg, #00ff99, #00e6ff, #00ffcc, #00ff99);
                background-size: 300% 300%;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                animation: gradient-shift 3s ease infinite;
                filter: drop-shadow(0 0 15px rgba(0, 255, 153, 0.7)) drop-shadow(0 0 30px rgba(0, 230, 255, 0.5));
            }
            @keyframes gradient-shift {
                0%, 100% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
            }
        }
        .filters {
            position: fixed;
            top: 60px;
            left: 16px;
            z-index: 100;
            width: 260px;
        }
        .settings-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: var(--surface);
            border: 1px solid var(--primary);
            border-radius: 10px;
            color: var(--primary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
            box-shadow: 0 2px 8px rgba(0, 204, 102, 0.1);
            transition: all 0.2s ease;
        }
        .settings-toggle:hover, .settings-toggle:active {
            background: var(--surface);
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(0, 204, 102, 0.15);
            transform: translateY(-1px);
        }
        .settings-toggle.open {
            background: var(--primary);
            color: var(--dark);
            box-shadow: 0 4px 12px rgba(0, 204, 102, 0.3);
        }
        .settings-toggle-icon {
            transition: transform 0.2s ease-out;
        }
        .settings-toggle.open .settings-toggle-icon {
            transform: rotate(90deg);
        }
        .settings-content {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 0.5rem;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
            transition: max-height 0.25s ease-out, opacity 0.2s ease-out;
        }
        .settings-content.open {
            max-height: 450px;
            opacity: 1;
            overflow-y: auto;
        }
        .settings-group {
            padding: 0.875rem;
            border-bottom: 1px solid var(--border);
        }
        .settings-group:last-child {
            border-bottom: none;
        }
        .settings-title {
            font-size: 0.6875rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 0.625rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .search-input {
            width: 100%;
            padding: 0.5625rem 0.6875rem;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.875rem;
        }
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        .search-input::placeholder {
            color: var(--text-muted);
        }
        .filter-btn {
            display: block;
            width: 100%;
            padding: 0.625rem 0.875rem;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.8125rem;
            font-weight: 400;
            cursor: pointer;
            margin-bottom: 0.375rem;
            text-align: left;
            transition: all 0.15s ease;
        }
        .filter-btn:hover {
            border-color: var(--text-muted);
            background: rgba(255, 255, 255, 0.03);
        }
        .filter-btn:active {
            transform: scale(0.98);
        }
        .filter-btn.active {
            background: var(--primary);
            color: var(--dark);
            border-color: var(--primary);
            font-weight: 500;
        }
        .filter-btn.risk-4.active { background: var(--danger); border-color: var(--danger); }
        .filter-btn.risk-3.active { background: var(--warning); border-color: var(--warning); }
        .filter-btn.risk-2.active { background: #eab308; border-color: #eab308; color: var(--dark); }
        .filter-btn.risk-1.active { background: var(--success); border-color: var(--success); }
        .filter-btn.risk-0.active { background: #64748b; border-color: #64748b; }
        .map-style-buttons {
            display: flex;
            gap: 0.5rem;
        }
        .map-style-btn {
            flex: 1;
            padding: 0.5rem;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
        }
        .map-style-btn:hover {
            border-color: var(--text-muted);
        }
        .map-style-btn.active {
            background: var(--primary);
            color: var(--dark);
            border-color: var(--primary);
        }
        #cached-mode-btn.active {
            background: var(--primary);
            color: var(--dark);
            border-color: var(--primary);
            font-weight: 600;
        }
        .stats {
            position: fixed;
            top: 60px;
            right: 16px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
        }
        .stat-item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.625rem 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.625rem;
            font-size: 0.8125rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            transition: transform 0.15s ease;
        }
        .stat-item:hover {
            transform: scale(1.02);
        }
        .stat-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .stat-value {
            font-weight: 600;
            color: var(--primary);
        }
        .stat-label {
            color: var(--text-muted);
        }
        .stat-high { border-left: 2px solid var(--danger); }
        .stat-high .stat-value { color: var(--danger); }
        .stat-high .stat-dot { background: var(--danger); }
        .stat-medium { border-left: 2px solid var(--warning); }
        .stat-medium .stat-value { color: var(--warning); }
        .stat-medium .stat-dot { background: var(--warning); }
        .stat-low { border-left: 2px solid var(--success); }
        .stat-low .stat-value { color: var(--success); }
        .stat-low .stat-dot { background: var(--success); }
        .stat-total { border-left: 2px solid var(--accent); }
        .stat-total .stat-value { color: var(--accent); }
        .stat-total .stat-dot { background: var(--accent); }
        .leaflet-popup-content-wrapper {
            background: var(--surface) !important;
            border: 1px solid var(--border) !important;
            border-radius: 8px !important;
            color: var(--text) !important;
        }
        .leaflet-popup-tip {
            background: var(--surface) !important;
        }
        .leaflet-container a.leaflet-popup-close-button {
            color: var(--primary) !important;
        }
        .leaflet-container a.leaflet-popup-close-button:hover {
            color: var(--accent) !important;
        }
        .plant-marker {
            cursor: pointer;
        }
        @media (max-width: 768px) {
            .filters {
                left: 10px;
                right: 10px;
                width: auto;
            }
            .stats {
                right: 10px;
                top: auto;
                bottom: 14px;
                gap: 0.3125rem;
            }
            .stat-item {
                padding: 0.5625rem 0.75rem;
                font-size: 0.75rem;
            }
            .logo {
                font-size: 1rem;
            }
            .subtitle {
                font-size: 0.6875rem;
            }
            .settings-toggle {
                padding: 0.6875rem 0.9375rem;
            }
            .filter-btn, .map-style-btn {
                padding: 0.5625rem 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="header">
        <div class="logo">Hillsboro Allergenic Plants</div>
        <div class="subtitle">Special thanks to Dr. Ling</div>
    </div>
    
    <div class="filters">
        <div class="settings-toggle" id="settings-toggle">
            <span>‚öôÔ∏è Settings</span>
            <span class="settings-toggle-icon">‚ñ∂</span>
        </div>
        <div class="settings-content" id="settings-content">
            <div class="settings-group">
                <div class="settings-title">üîç Search</div>
                <input type="text" class="search-input" id="search-input" placeholder="Search plants...">
            </div>
            <div class="settings-group">
                <div class="settings-title">‚ö†Ô∏è Allergen Level</div>
                <button class="filter-btn active" data-filter="all">All Plants</button>
                <button class="filter-btn risk-4" data-filter="VERY_HIGH">Level 4 - Very High</button>
                <button class="filter-btn risk-3" data-filter="HIGH">Level 3 - High</button>
                <button class="filter-btn risk-2" data-filter="MEDIUM">Level 2 - Medium</button>
                <button class="filter-btn risk-1" data-filter="LOW">Level 1 - Low</button>
                <button class="filter-btn risk-0" data-filter="NONE">Level 0 - None</button>
            </div>
            <div class="settings-group">
                <div class="settings-title">üó∫Ô∏è Map Style</div>
                <div class="map-style-buttons">
                    <button class="map-style-btn active" data-style="osm">OSM</button>
                    <button class="map-style-btn" data-style="dark">Dark</button>
                </div>
            </div>

        </div>
    </div>
    
    <div class="stats">
        <div class="stat-item stat-high">
            <div class="stat-dot"></div>
            <span class="stat-label">High:</span>
            <span class="stat-value" id="high-count">0</span>
        </div>
        <div class="stat-item stat-medium">
            <div class="stat-dot"></div>
            <span class="stat-label">Med:</span>
            <span class="stat-value" id="medium-count">0</span>
        </div>
        <div class="stat-item stat-low">
            <div class="stat-dot"></div>
            <span class="stat-label">Low:</span>
            <span class="stat-value" id="low-count">0</span>
        </div>
        <div class="stat-item stat-total">
            <div class="stat-dot"></div>
            <span class="stat-value" id="total-count">0</span>
        </div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script>
        var SOUTH_LAT = 45.52993828514016;
        var NORTH_LAT = 45.53546974562078;
        var WEST_LON = -122.91590598637916;
        var EAST_LON = -122.9059067121697;
        
        var map, currentTileLayer, plantMarkers = [], allPlants = [];
        var currentRiskFilter = 'all';
        var currentSearch = '';
        
        var plantFiles = [
            {id: 2026021901, name: "Sequoiadendron giganteum", commonName: "giant sequoia", lat: 45.5321752959445, lon: -122.913260324346, allergenLevel: 1, filename: "images/2026021901-45.5321752959445, -122.91326032434674.jpg"},
            {id: 2026021902, name: "Viburnum davidii", commonName: "David viburnum", lat: 45.53282563722502, lon: -122.912916089902, allergenLevel: 1, filename: "images/2026021902-45.53282563722502, -122.91291608990245.jpg"},
            {id: 2026021903, name: "Erica carne", commonName: "winter heath", lat: 45.53396638810642, lon: -122.912357320864, allergenLevel: 1, filename: "images/2026021903-45.53396638810642, -122.91235732086496.jpg"},
            {id: 2026021904, name: "Ficaria verna", commonName: "lesser celandine", lat: 45.53398377090098, lon: -122.912493469825, allergenLevel: 1, filename: "images/2026021904-45.53398377090098, -122.91249346982507.jpg"},
            {id: 2026021905, name: "Cornus sericea", commonName: "Red osier dogwood", lat: 45.53393812614244, lon: -122.91240900121, allergenLevel: 1, filename: "images/2026021905-45.53393812614244, -122.91240900121086.jpg"},
            {id: 2026021906, name: "Glechoma grandis", commonName: "Creeping Charlie", lat: 45.531645855028884, lon: -122.912984342538, allergenLevel: 1, filename: "images/2026021906-45.531645855028884, -122.91298434253892.jpg"},
            {id: 2026021907, name: "Bellis perennis", commonName: "English daisy", lat: 45.532409356253886, lon: -122.908980975393, allergenLevel: 1, filename: "images/2026021907-45.532409356253886, -122.90898097539352.jpg"},
            {id: 2026021908, name: "Trachycarpus fortunei", commonName: "windmill palm", lat: 45.5313410531488, lon: -122.912924117214, allergenLevel: 1, filename: "images/2026021908-45.5313410531488, -122.9129241172142.jpg"},
            {id: 2026021909, name: "Nandina domestica", commonName: "heavenly bamboo", lat: 45.53170593394621, lon: -122.913082974817, allergenLevel: 1, filename: "images/2026021909-45.53170593394621, -122.9130829748173.jpg"},
            {id: 2026021910, name: "Rosa cinnamomea", commonName: "roses", lat: 45.53311272658652, lon: -122.912624468911, allergenLevel: 1, filename: "images/2026021910-45.53311272658652, -122.91262446891169.jpg"},
            {id: 2026021911, name: "Berberis aquifolium", commonName: "Oregon grape", lat: 45.53307765167972, lon: -122.912595854875, allergenLevel: 1, filename: "images/2026021911-45.53307765167972, -122.91259585487556.jpg"},
            {id: 2026021912, name: "Berberis aquifolium", commonName: "Oregon grape", lat: 45.533192713938924, lon: -122.912694409743, allergenLevel: 1, filename: "images/2026021912-45.533192713938924, -122.91269440974315.jpg"},
            {id: 2026021913, name: "Cornus sericea", commonName: "Red osier dogwood", lat: 45.53336430634478, lon: -122.912775110457, allergenLevel: 1, filename: "images/2026021913-45.53336430634478, -122.91277511045735.jpg"},
            {id: 2026021914, name: "Phylum Bryophyta", commonName: "mosses", lat: 45.53390788276676, lon: -122.912406364594, allergenLevel: 0, filename: "images/2026021914-45.53390788276676, -122.91240636459491.jpg"},
            {id: 2026021915, name: "Phalaris arundinacea", commonName: "reed canary grass", lat: 45.53394405066908, lon: -122.912394965205, allergenLevel: 3, filename: "images/2026021915-45.53394405066908, -122.91239496520566.jpg"},
            {id: 2026021916, name: "Narcissus pseudonarcissus", commonName: "Lent lily", lat: 45.53350914966736, lon: -122.913067109456, allergenLevel: 4, filename: "images/2026021916-45.53350914966736, -122.91306710945696.jpg"},
            {id: 2026021918, name: "Cornus sericea", commonName: "Red osier dogwood", lat: 45.533431483781975, lon: -122.912892197257, allergenLevel: 1, filename: "images/2026021918-45.533431483781975, -122.91289219725729.jpg"},
            {id: 2026021919, name: "Chamaecyparis obtusa", commonName: "Hinoki cypress", lat: 45.53168210236934, lon: -122.913110801689, allergenLevel: 3, filename: "images/2026021919-45.53168210236934, -122.9131108016896.jpg"},
            {id: 2026021920, name: "Cryptomeria japonica", commonName: "Japanese cedar", lat: 45.531722029553265, lon: -122.91304240536, allergenLevel: 3, filename: "images/2026021920-45.531722029553265, -122.91304240536083.jpg"},
            {id: 2026021921, name: "Genus Taxus", commonName: "yews", lat: 45.53175397127998, lon: -122.912969315166, allergenLevel: 2, filename: "images/2026021921-45.53175397127998, -122.91296931516638.jpg"},
            {id: 2026021922, name: "Cupressus sempervirens", commonName: "Italian cypress", lat: 45.531628, lon: -122.912094, allergenLevel: 3, filename: "images/2026021922-45.531628, -122.912094.jpg"},
            {id: 2026021923, name: "Cupressus sempervirens", commonName: "Italian cypress", lat: 45.531666, lon: -122.912091, allergenLevel: 3, filename: "images/2026021923-45.531666, -122.912091.jpg"},
            {id: 2026021924, name: "Buxus sempervirens", commonName: "common boxwood", lat: 45.531707, lon: -122.911945, allergenLevel: 1, filename: "images/2026021924-45.531707, -122.911945.jpg"},
            {id: 2026021925, name: "Berberis aquifolium", commonName: "Oregon grape", lat: 45.531832, lon: -122.91182, allergenLevel: 1, filename: "images/2026021925-45.531832, -122.911820.jpg"},
            {id: 2026021926, name: "Berberis aquifolium", commonName: "Oregon grape", lat: 45.53189, lon: -122.911767, allergenLevel: 1, filename: "images/2026021926-45.53189, -122.911767.jpg"},
            {id: 2026021927, name: "Genus Cenchrus", commonName: "sandburs / buffelgrass", lat: 45.532071, lon: -122.91289, allergenLevel: 3, filename: "images/2026021927-45.532071, -122.912890.jpg"},
            {id: 2026021928, name: "Chamaecyparis obtusa", commonName: "Hinoki cypress", lat: 45.532125, lon: -122.912734, allergenLevel: 3, filename: "images/2026021928-45.532125, -122.912734.jpg"},
            {id: 2026021929, name: "Magnolia stellata", commonName: "star magnolia", lat: 45.532266, lon: -122.912586, allergenLevel: 1, filename: "images/2026021929-45.532266, -122.912586.jpg"},
            {id: 2026021930, name: "Berberis repens", commonName: "Creeping Oregon grape", lat: 45.5322, lon: -122.9118, allergenLevel: 1, filename: "images/2026021930-45.532200, -122.911800.jpg"},
            {id: 2026021931, name: "Salix babylonica", commonName: "weeping willow", lat: 45.5319904313497, lon: -122.91128480587, allergenLevel: 3, filename: "images/2026021931-45.5319904313497, -122.91128480587012.jpg"},
            {id: 2026021932, name: "Salix babylonica", commonName: "weeping willow", lat: 45.5318671821094, lon: -122.911318189187, allergenLevel: 3, filename: "images/2026021932-45.5318671821094, -122.91131818918747.jpg"},
            {id: 2026021933, name: "Salix babylonica", commonName: "weeping willow", lat: 45.53211797681711, lon: -122.911055438505, allergenLevel: 3, filename: "images/2026021933-45.53211797681711, -122.91105543850537.jpg"},
            {id: 2026021934, name: "Betula pendula", commonName: "silver birch", lat: 45.53208650458752, lon: -122.910814248109, allergenLevel: 4, filename: "images/2026021934-45.53208650458752, -122.91081424810952.jpg"},
            {id: 2026021935, name: "Genus Quercus", commonName: "oaks", lat: 45.53216601334353, lon: -122.910069395362, allergenLevel: 4, filename: "images/2026021935-45.53216601334353, -122.91006939536231.jpg"},
            {id: 2026021936, name: "Genus Quercus", commonName: "oaks", lat: 45.53215441832397, lon: -122.909315084152, allergenLevel: 4, filename: "images/2026021936-45.53215441832397, -122.90931508415288.jpg"},
            {id: 2026021937, name: "Zelkova serrata", commonName: "zelkova", lat: 45.53235784895571, lon: -122.908250822645, allergenLevel: 2, filename: "images/2026021937-45.53235784895571, -122.90825082264514.jpg"},
            {id: 2026021938, name: "Genus Pinus", commonName: "pines", lat: 45.5324100203886, lon: -122.90715308263, allergenLevel: 2, filename: "images/2026021938-45.5324100203886, -122.90715308263019.jpg"},
            {id: 2026021939, name: "Genus Pinus", commonName: "pines", lat: 45.53281244993523, lon: -122.907213664951, allergenLevel: 2, filename: "images/2026021939-45.53281244993523, -122.90721366495113.jpg"},
            {id: 2026021940, name: "Sonchus asper", commonName: "thistle sowthistle", lat: 45.532569719755834, lon: -122.907714849329, allergenLevel: 2, filename: "images/2026021940-45.532569719755834, -122.90771484932984.jpg"},
            {id: 2026021941, name: "Genus Pinus", commonName: "pines", lat: 45.53236939937172, lon: -122.909261127117, allergenLevel: 2, filename: "images/2026021941-45.53236939937172, -122.90926112711794.jpg"},
            {id: 2026021942, name: "Subfamily Cupressoideae", commonName: "cypress subfamily", lat: 45.53252097348167, lon: -122.910805735551, allergenLevel: 3, filename: "images/2026021942-45.53252097348167, -122.9108057355514.jpg"},
            {id: 2026021943, name: "Calocedrus decurrens", commonName: "incense cedar", lat: 45.53251075594764, lon: -122.910961940538, allergenLevel: 4, filename: "images/2026021943-45.53251075594764, -122.9109619405381.jpg"},
            {id: 2026021944, name: "Prunus laurocerasus", commonName: "cherry laurel", lat: 45.53294891122775, lon: -122.911928034714, allergenLevel: 1, filename: "images/2026021944-45.53294891122775, -122.91192803471482.jpg"},
            {id: 2026021945, name: "Rubus ursinus", commonName: "trailing blackberry", lat: 45.532975828051356, lon: -122.911919358051, allergenLevel: 1, filename: "images/2026021945-45.532975828051356, -122.9119193580519.jpg"},
            {id: 2026021946, name: "Quercus garryana", commonName: "Oregon white oak", lat: 45.533046985868474, lon: -122.91194338249, allergenLevel: 4, filename: "images/2026021946-45.533046985868474, -122.91194338249097.jpg"},
            {id: 2026021947, name: "Betula pendula", commonName: "silver birch", lat: 45.53421577278697, lon: -122.910039698653, allergenLevel: 4, filename: "images/2026021947-45.53421577278697, -122.91003969865305.jpg"},
            {id: 2026021948, name: "Genus Pinus", commonName: "pines", lat: 45.53425353175589, lon: -122.909456778568, allergenLevel: 2, filename: "images/2026021948-45.53425353175589, -122.90945677856897.jpg"},
            {id: 2026021949, name: "Sequoiadendron giganteum", commonName: "giant sequoia", lat: 45.53441041476725, lon: -122.909134913483, allergenLevel: 1, filename: "images/2026021949-45.53441041476725, -122.9091349134837.jpg"},
            {id: 2026021950, name: "Genus Quercus", commonName: "oaks", lat: 45.53487233732631, lon: -122.908122255414, allergenLevel: 4, filename: "images/2026021950-45.53487233732631, -122.90812225541454.jpg"},
            {id: 2026021951, name: "Genus Chamaecyparis", commonName: "false cypresses", lat: 45.53117539611153, lon: -122.912929592258, allergenLevel: 3, filename: "images/2026021951-45.53117539611153, -122.91292959225831.jpg"},
            {id: 2026021952, name: "Subfamily Cupressoideae", commonName: "cypress subfamily", lat: 45.53119325216708, lon: -122.912924226009, allergenLevel: 3, filename: "images/2026021952-45.53119325216708, -122.91292422600974.jpg"},
            {id: 2026021953, name: "Genus Chamaecyparis", commonName: "false cypresses", lat: 45.531198575388956, lon: -122.913128354632, allergenLevel: 3, filename: "images/2026021953-45.531178376744485, -122.9131333837779.jpg"},
            {id: 2026021954, name: "Chamaecyparis obtusa", commonName: "Hinoki cypress", lat: 45.531178376744485, lon: -122.913133383777, allergenLevel: 3, filename: "images/2026021954-45.531198575388956, -122.91312835463295.jpg"},
            {id: 2026021955, name: "Pieris japonica", commonName: "Lily-of-the-valley shrub", lat: 45.53126925704983, lon: -122.914010888883, allergenLevel: 1, filename: "images/2026021955-45.53126925704983, -122.9140108888836.jpg"},
            {id: 2026021956, name: "Pieris japonica", commonName: "Lily-of-the-valley shrub", lat: 45.53124869386331, lon: -122.913968715778, allergenLevel: 1, filename: "images/2026021956-45.53124869386331, -122.91396871577867.jpg"},
            {id: 2026021957, name: "Prunus laurocerasus", commonName: "cherry laurel", lat: 45.53126043724613, lon: -122.913962010255, allergenLevel: 1, filename: "images/2026021957-45.53126043724613, -122.91396201025599.jpg"},
            {id: 2026021958, name: "Chamaecyparis obtusa", commonName: "Hinoki cypress", lat: 45.5316956287817, lon: -122.913122607456, allergenLevel: 3, filename: "images/2026021958-45.5316956287817, -122.91312260745619.jpg"},
            {id: 2026021959, name: "Taxus baccata", commonName: "Common yew", lat: 45.5317130088511, lon: -122.913060916653, allergenLevel: 2, filename: "images/2026021959-45.5317130088511, -122.9130609166537.jpg"},
            {id: 2026021960, name: "Taxus baccata", commonName: "Common yew", lat: 45.53175622413103, lon: -122.912954298842, allergenLevel: 2, filename: "images/2026021960-45.53175622413103, -122.9129542988429.jpg"},
            {id: 2026021961, name: "Cryptomeria japonica", commonName: "Japanese cedar", lat: 45.53188013564473, lon: -122.913032695982, allergenLevel: 3, filename: "images/2026021961-45.53188013564473, -122.91303269598295.jpg"},
            {id: 2026021962, name: "Chamaecyparis obtusa", commonName: "Hinoki cypress", lat: 45.53181249934496, lon: -122.913500863692, allergenLevel: 3, filename: "images/2026021962-45.53181249934496, -122.91350086369259.jpg"},
            {id: 2026021963, name: "Viburnum davidii", commonName: "David viburnum", lat: 45.53166053881448, lon: -122.91382927386, allergenLevel: 1, filename: "images/2026021963-45.53166053881448, -122.91382927386064.jpg"},
            {id: 2026021964, name: "Subfamily Cupressoideae", commonName: "cypress subfamily", lat: 45.53174357026187, lon: -122.913623613861, allergenLevel: 3, filename: "images/2026021964-45.53174357026187, -122.91362361386122.jpg"}
        ];
        
        function getPlantColor(plant) {
            var level = plant.allergenLevel;
            switch(level) {
                case 4: return { fill: '#ef4444', level: 'Level 4 - Very High' };
                case 3: return { fill: '#f97316', level: 'Level 3 - High' };
                case 2: return { fill: '#fbbf24', level: 'Level 2 - Medium' };
                case 1: return { fill: '#22c55e', level: 'Level 1 - Low' };
                case 0: return { fill: '#64748b', level: 'Level 0 - None' };
                default: return { fill: '#64748b', level: 'Level 0 - None' };
            }
        }

        var currentTileStyle = 'osm';
        
        function initMap() {
            var southWest = L.latLng(SOUTH_LAT, WEST_LON);
            var northEast = L.latLng(NORTH_LAT, EAST_LON);
            var bounds = L.latLngBounds(southWest, northEast);
            
            var centerLat = (SOUTH_LAT + NORTH_LAT) / 2;
            var centerLon = (WEST_LON + EAST_LON) / 2;
            
            map = L.map('map', {
                center: [centerLat, centerLon],
                zoom: 16,
                minZoom: 15,
                maxZoom: 20
            });
            
            setMapStyle('osm');
            addPlantMarkers();
            updateStats();
        }
        
        function setMapStyle(style) {
            if (currentTileLayer) {
                map.removeLayer(currentTileLayer);
            }
            
            currentTileStyle = style;
            var tileUrl, attribution;
            if (style === 'dark') {
                tileUrl = 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png';
                attribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>';
            } else {
                tileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
                attribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>';
            }
            
            currentTileLayer = L.tileLayer(tileUrl, {
                attribution: attribution,
                maxZoom: 20,
                minZoom: 15,
                crossOrigin: true
            }).addTo(map);
        }
        
        function addPlantMarkers() {
            plantFiles.forEach(function(plant) {
                var colorInfo = getPlantColor(plant);
                
                var marker = L.circleMarker([plant.lat, plant.lon], {
                    radius: 8,
                    fillColor: colorInfo.fill,
                    color: '#ffffff',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.85,
                    className: 'plant-marker'
                }).addTo(map);
                
                var popupContent = '<div style="min-width: 240px; padding: 0;">' +
                    '<img src="' + plant.filename + '" style="width: 100%; height: 130px; object-fit: cover; display: block; border-radius: 6px 6px 0 0;" onerror="this.style.display=\'none\'">' +
                    '<div style="padding: 10px;">' +
                    '<div style="margin-bottom: 8px;">' +
                    '<strong style="color: #00cc66; font-size: 0.9375rem; display: block;">' + plant.name + '</strong>' +
                    '<span style="color: #94a3b8; font-size: 0.8125rem;">' + plant.commonName + '</span>' +
                    '</div>' +
                    '<div style="display: flex; justify-content: space-between; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.8125rem;">' +
                    '<span style="color: #94a3b8;">Level:</span>' +
                    '<span style="color: ' + colorInfo.fill + '; font-weight: 600;">' + colorInfo.level + '</span>' +
                    '</div>' +
                    '</div>' +
                    '</div>';
                
                marker.bindPopup(popupContent);
                marker.plantId = plant.id;
                plantMarkers.push({ marker: marker, plant: plant });
                allPlants.push(plant);
            });
        }
        
        function updateStats() {
            var highCount = 0, mediumCount = 0, lowCount = 0;
            
            allPlants.forEach(function(plant) {
                if (plant.allergenLevel === 4 || plant.allergenLevel === 3) {
                    highCount++;
                } else if (plant.allergenLevel === 2) {
                    mediumCount++;
                } else if (plant.allergenLevel === 1) {
                    lowCount++;
                }
            });
            
            document.getElementById('high-count').textContent = highCount;
            document.getElementById('medium-count').textContent = mediumCount;
            document.getElementById('low-count').textContent = lowCount;
            document.getElementById('total-count').textContent = allPlants.length;
        }
        
        function filterPlants() {
            var filtered = allPlants;
            
            if (currentRiskFilter !== 'all') {
                filtered = filtered.filter(function(plant) {
                    if (currentRiskFilter === 'VERY_HIGH') return plant.allergenLevel === 4;
                    if (currentRiskFilter === 'HIGH') return plant.allergenLevel === 3;
                    if (currentRiskFilter === 'MEDIUM') return plant.allergenLevel === 2;
                    if (currentRiskFilter === 'LOW') return plant.allergenLevel === 1;
                    if (currentRiskFilter === 'NONE') return plant.allergenLevel === 0;
                    return true;
                });
            }
            
            if (currentSearch.trim() !== '') {
                var searchLower = currentSearch.toLowerCase();
                filtered = filtered.filter(function(plant) {
                    return plant.name.toLowerCase().includes(searchLower) ||
                           (plant.commonName && plant.commonName.toLowerCase().includes(searchLower));
                });
            }
            
            plantMarkers.forEach(function(item) {
                var isVisible = filtered.some(function(p) { return p.id === item.plant.id; });
                if (isVisible) {
                    if (!item.marker._map) {
                        item.marker.addTo(map);
                    }
                } else {
                    if (item.marker._map) {
                        map.removeLayer(item.marker);
                    }
                }
            });
            
            document.getElementById('total-count').textContent = filtered.length;
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            
            document.getElementById('settings-toggle').addEventListener('click', function() {
                this.classList.toggle('open');
                document.getElementById('settings-content').classList.toggle('open');
            });
            
            document.querySelectorAll('.filter-btn[data-filter]').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn[data-filter]').forEach(function(b) { b.classList.remove('active'); });
                    this.classList.add('active');
                    currentRiskFilter = this.getAttribute('data-filter');
                    filterPlants();
                });
            });
            
            document.querySelectorAll('.map-style-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.map-style-btn').forEach(function(b) { b.classList.remove('active'); });
                    this.classList.add('active');
                    setMapStyle(this.getAttribute('data-style'));
                });
            });
            
            document.getElementById('search-input').addEventListener('input', function(e) {
                currentSearch = e.target.value;
                filterPlants();
            });

        });

    </script>
</body>
</html>